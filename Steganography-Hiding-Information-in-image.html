<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Image Steganography App
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow-md">
   <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
    <div class="flex items-center space-x-3">
     <img alt="Logo with letters I and S in white on blue background" class="w-10 h-10 rounded" height="40" src="https://storage.googleapis.com/a1aa/image/814d1b5d-5124-4776-d702-cde531b2faa9.jpg" width="40"/>
     <h1 class="text-2xl font-semibold text-gray-800">
      Image Steganography
     </h1>
    </div>
    <nav class="hidden md:flex space-x-6 text-gray-600 font-medium">
     <a class="hover:text-blue-600 transition" href="#encode">
      Encode
     </a>
     <a class="hover:text-blue-600 transition" href="#decode">
      Decode
     </a>
     <a class="hover:text-blue-600 transition" href="#about">
      About
     </a>
    </nav>
    <button aria-label="Toggle menu" class="md:hidden text-gray-600 hover:text-blue-600 focus:outline-none" id="mobile-menu-button">
     <i class="fas fa-bars fa-lg">
     </i>
    </button>
   </div>
   <nav class="md:hidden bg-white border-t border-gray-200 hidden" id="mobile-menu">
    <a class="block px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600" href="#encode">
     Encode
    </a>
    <a class="block px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600" href="#decode">
     Decode
    </a>
    <a class="block px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600" href="#about">
     About
    </a>
   </nav>
  </header>
  <main class="flex-grow max-w-5xl mx-auto px-4 py-8 space-y-16">
   <section class="bg-white rounded-lg shadow p-6" id="encode">
    <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center space-x-3">
     <i class="fas fa-lock fa-lg text-blue-600">
     </i>
     <span>
      Encode Message into Image
     </span>
    </h2>
    <form class="space-y-6" id="encode-form">
     <div>
      <label class="block text-gray-700 font-medium mb-2" for="input-image">
       Select Image (PNG or JPG)
      </label>
      <input accept="image/png, image/jpeg" class="block w-full text-gray-700 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" id="input-image" required="" type="file"/>
     </div>
     <div>
      <label class="block text-gray-700 font-medium mb-2" for="message">
       Message to hide
      </label>
      <textarea class="block w-full border border-gray-300 rounded-md p-3 resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-700" id="message" placeholder="Enter your secret message here..." required="" rows="4"></textarea>
     </div>
     <button class="inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-3 rounded-md transition" type="submit">
      <i class="fas fa-file-upload">
      </i>
      <span>
       Encode &amp; Download
      </span>
     </button>
    </form>
    <div class="mt-6 text-center text-green-700 font-semibold" id="encode-result">
    </div>
   </section>
   <section class="bg-white rounded-lg shadow p-6" id="decode">
    <h2 class="text-3xl font-semibold text-gray-800 mb-6 flex items-center space-x-3">
     <i class="fas fa-unlock fa-lg text-blue-600">
     </i>
     <span>
      Decode Message from Image
     </span>
    </h2>
    <form class="space-y-6" id="decode-form">
     <div>
      <label class="block text-gray-700 font-medium mb-2" for="encoded-image">
       Select Image with Hidden Message (PNG or JPG)
      </label>
      <input accept="image/png, image/jpeg" class="block w-full text-gray-700 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" id="encoded-image" required="" type="file"/>
     </div>
     <button class="inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-3 rounded-md transition" type="submit">
      <i class="fas fa-search">
      </i>
      <span>
       Decode Message
      </span>
     </button>
    </form>
    <div class="mt-6 p-4 bg-gray-100 rounded-md text-gray-800 whitespace-pre-wrap break-words min-h-[4rem]" id="decode-result">
    </div>
   </section>
   <section class="bg-white rounded-lg shadow p-6 max-w-4xl mx-auto text-gray-700" id="about">
    <h2 class="text-3xl font-semibold text-gray-800 mb-4 flex items-center space-x-3">
     <i class="fas fa-info-circle fa-lg text-blue-600">
     </i>
     <span>
      About This App
     </span>
    </h2>
    <p class="mb-4 leading-relaxed">
     This web application allows you to hide secret text messages inside images
        using a technique called steganography. The message is encoded into the
        least significant bits of the image's pixels, making it invisible to the
        naked eye.
    </p>
    <p class="mb-4 leading-relaxed">
     You can upload an image and a secret message to encode, then download the
        encoded image. Later, you can upload the encoded image to decode and reveal
        the hidden message.
    </p>
    <p class="leading-relaxed">
     This app works entirely in your browser using JavaScript, so your images
        and messages never leave your device.
    </p>
   </section>
  </main>
  <footer class="bg-white border-t border-gray-200 py-6 mt-12">
   <div class="max-w-5xl mx-auto px-4 text-center text-gray-500 text-sm">
    © 2024 Image Steganography App. All rights reserved.
   </div>
  </footer>
  <script>
   // Mobile menu toggle
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // Utility functions for encoding/decoding
    function textToBinary(text) {
      return text
        .split('')
        .map((char) => char.charCodeAt(0).toString(2).padStart(8, '0'))
        .join('');
    }

    function binaryToText(binary) {
      let result = '';
      for (let i = 0; i < binary.length; i += 8) {
        const byte = binary.slice(i, i + 8);
        result += String.fromCharCode(parseInt(byte, 2));
      }
      return result;
    }

    // Encode message into image data
    function encodeMessageInImageData(imageData, message) {
      const binaryMessage = textToBinary(message) + '1111111111111110'; // End delimiter
      const data = imageData.data;
      let msgIndex = 0;

      for (let i = 0; i < data.length; i += 4) {
        for (let channel = 0; channel < 3; channel++) {
          if (msgIndex < binaryMessage.length) {
            data[i + channel] = (data[i + channel] & ~1) | parseInt(binaryMessage[msgIndex]);
            msgIndex++;
          }
        }
      }

      if (msgIndex < binaryMessage.length) {
        return false; // Message too long for image
      }
      return true;
    }

    // Decode message from image data
    function decodeMessageFromImageData(imageData) {
      const data = imageData.data;
      let binaryMessage = '';

      for (let i = 0; i < data.length; i += 4) {
        for (let channel = 0; channel < 3; channel++) {
          binaryMessage += (data[i + channel] & 1).toString();
        }
      }

      const endIndex = binaryMessage.indexOf('1111111111111110');
      if (endIndex !== -1) {
        binaryMessage = binaryMessage.slice(0, endIndex);
        return binaryToText(binaryMessage);
      } else {
        return null;
      }
    }

    // Handle encode form submission
    const encodeForm = document.getElementById('encode-form');
    const encodeResult = document.getElementById('encode-result');

    encodeForm.addEventListener('submit', (e) => {
      e.preventDefault();
      encodeResult.textContent = '';
      const fileInput = document.getElementById('input-image');
      const messageInput = document.getElementById('message');

      if (!fileInput.files.length) {
        encodeResult.textContent = '⚠ Please select an image file.';
        encodeResult.classList.remove('text-green-700');
        encodeResult.classList.add('text-red-600');
        return;
      }

      const file = fileInput.files[0];
      const message = messageInput.value.trim();
      if (!message) {
        encodeResult.textContent = '⚠ Please enter a message to encode.';
        encodeResult.classList.remove('text-green-700');
        encodeResult.classList.add('text-red-600');
        return;
      }

      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const success = encodeMessageInImageData(imageData, message);

          if (!success) {
            encodeResult.textContent =
              '⚠ Message is too long to encode in this image. Please use a shorter message or a larger image.';
            encodeResult.classList.remove('text-green-700');
            encodeResult.classList.add('text-red-600');
            return;
          }

          ctx.putImageData(imageData, 0, 0);
          canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'encoded-image.png';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            encodeResult.textContent = '✅ Message successfully encoded! Image downloaded.';
            encodeResult.classList.remove('text-red-600');
            encodeResult.classList.add('text-green-700');
            encodeForm.reset();
          }, 'image/png');
        };
        img.onerror = function () {
          encodeResult.textContent = '⚠ Failed to load the image. Please try another file.';
          encodeResult.classList.remove('text-green-700');
          encodeResult.classList.add('text-red-600');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    // Handle decode form submission
    const decodeForm = document.getElementById('decode-form');
    const decodeResult = document.getElementById('decode-result');

    decodeForm.addEventListener('submit', (e) => {
      e.preventDefault();
      decodeResult.textContent = '';
      const fileInput = document.getElementById('encoded-image');

      if (!fileInput.files.length) {
        decodeResult.textContent = '⚠ Please select an image file.';
        decodeResult.classList.remove('text-green-700');
        decodeResult.classList.add('text-red-600');
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const message = decodeMessageFromImageData(imageData);

          if (message === null || message.length === 0) {
            decodeResult.textContent = '⚠ No hidden message found.';
            decodeResult.classList.remove('text-green-700');
            decodeResult.classList.add('text-red-600');
          } else {
            decodeResult.textContent = message;
            decodeResult.classList.remove('text-red-600');
            decodeResult.classList.add('text-green-700');
          }
          decodeForm.reset();
        };
        img.onerror = function () {
          decodeResult.textContent = '⚠ Failed to load the image. Please try another file.';
          decodeResult.classList.remove('text-green-700');
          decodeResult.classList.add('text-red-600');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
 </body>
</html>
